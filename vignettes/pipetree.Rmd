---
title: "Getting Started"
author: "Matthew Mark Strasiotto"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
#library(pipetree)
```

# Intoduction to Pipetree

The goal of pipetree is to make navigating the project structure of the 
speed-extract project as simple as possible, and to automate the most commonly
used tasks in accessing and exploring the dataset.

The most important functionalities provided are as follows:

1. Consistent access of a given dataset's root directory accross remote
   volumes, whose mount points may change ( [portrpaths::PortrPath]. )
1. Consistent Access to the filetree structure, that is used by the any 
   SPEED-EXTRACT pipeline workflow/dataset.
1. Straightforward access to the [drake::drake_cache()] for a particular 
   dataset. 
   IE- Immediate access to the results, outputs, and targets generated by the
   data pipeline, as soon as these results are available.
1. __PLANNED__ access to structured metadata for a given dataset, so:
   * users have useful information about the distinguishing characteristics      of that dataset, and 
   * projects have useful aliases for structured and versioned logging of 
     target statistics.  
     - Use cases for this include:
        1. Allowing versioned tracking of multiple datasets'  
           [drake::drake_cache_log], within a versioned project/repo within
           separate subdirectories of the project that builds 
           these targets.
        1. Allowing more in-depth data versioning, such as versioned `yaml`
           files describing high level aggregates of a given 
           dataframe across the workflow, eg
           ```yaml
           n_journeys: 100
           n_journeys_stemi: 5
           ```
         
# Portable Access to Datasets

Portable access to datasets is driven by the [portrpaths::PortrPath] class, 
using the [get_portrpaths()] function.

This expects a local `yaml` config file at a location specified by the user.
This may be specified in one of a few ways:

## Using the pipetree.config option

By setting the global option `pipetree.config = /path/to/your/config.yaml`,
possibly in your user level *.Rprofile* (*~/.Rprofile*), or your project-level
*Rprofile* (`here::here()` */.Rprofile* ), a consistent location for this 
configuration file may be specified. 


```{r, include = FALSE}
temp_root <- tempdir()
option_config <- file.path(temp_root, "option_config.yaml")
default_config <- pipetree::default_config_path()

file.copy("./option_config.yaml", option_config)
file.copy("./default_config.yaml", default_config)
```

### Examining the config

Lets examine the file we're going to tell our options to use

The path:
```{r}
cat(option_config, sep = "\n")
```

The contents:

```{r}
for (ln in readLines(option_config)) cat(ln, sep = "\n")
```

### Setting the option

```{r}
options(pipetree.config = option_config)
```

Now let's load this configuration:

```{r}
portrpath <- pipetree::get_portrpath()
portrpath
```

